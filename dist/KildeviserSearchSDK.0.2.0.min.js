var Collection=function(e){this.name=m.prop("test name"),this.id=m.prop(e),this.description=m.prop(""),this.resourceUrl="http://www.kbhkilder.dk/api/collections/",this.searchUrl="http://www.kbhkilder.dk/api/data/"+e,this.filters=m.prop([]),this.values=m.prop([])};Collection.prototype.get=function(){var e=this.resourceUrl+this.id();m.request({method:"GET",url:e,dataType:"jsonp"}).then(function(e){this._loadData(e[0]),this.filters[0].updateValues([])}.bind(this))},Collection.prototype._loadData=function(e){for(var t=[],i=0;i<e.levels.length;i++)1==e.levels[i].searchable&&t.push(new Filter(this.id(),e.levels[i]));t.sort(function(e,t){return e.order-t.order}),this.filters=t},Collection.prototype.updateFilters=function(e,t){if(void 0!=e){for(var i=-1,l=0;l<this.filters.length;l++)this.filters[l].name()==e&&(i=l);if(-1!=i&&(this.filters[i].selectedValue(t),""===this.filters[i].selectedValue()||-1!=this.filters[i].values.indexOf(t))){var s=this._getFilterValues();0==this.filters[i].values.length&&this.filters[i].updateValues(s);for(var l=i+1;l<this.filters.length;l++)this.filters[l].updateValues(s)}}},Collection.prototype._getFilterValues=function(){for(var e=[],t=0;t<this.filters.length;t++){var i=this.filters[t];void 0!==i.selectedValue()&&e.push({name:i.name(),value:i.selectedValue()})}return e},Collection.prototype.search=function(){var e=new URLBuilder;return m.request({method:"GET",url:e.buildUrl(this.searchUrl,this._getFilterValues()),dataType:"jsonp"})};
var Filter=function(e,t){this.requiredLevels=void 0!==t.required_levels&&t.required_levels!==!1?t.required_levels:[],this.name=m.prop(t.name),this.gui_name=m.prop(t.gui_name),this.helpText=m.prop(t.gui_description),this.placeHolder=m.prop(t.gui_name),this.valuesUrl="http://www.kbhkilder.dk/api/metadata/"+e+"/"+t.name,this.selectedValue=m.prop(""),this.values=[],this.valuesStr=m.prop(""),this.order=t.order};Filter.prototype._requiredFiltersSet=function(e){if(0==this.requiredLevels.length)return!0;for(var t=0,i=0;i<e.length;i++)-1!==this.requiredLevels.indexOf(e[i].name)&&""!==e[i].value&&void 0!==e[i].value&&t++;return t!==this.requiredLevels.length?!1:!0},Filter.prototype.updateValues=function(e){this._requiredFiltersSet(e)?m.request({method:"GET",url:this._buildUrl(e),dataType:"jsonp"}).then(function(e){this.values=[];for(var t=0;t<e.length;t++)this.values.push(e[t].text);this.valuesStr(this._valuesToString(this.values)),-1==this.values.indexOf(this.selectedValue())&&this.selectedValue(""),1==this.values.length&&this.selectedValue(this.values[0])}.bind(this)):(this.values.length=0,this.valuesStr(this._valuesToString(this.values)),this.selectedValue(""))},Filter.prototype._buildUrl=function(e){var t=new URLBuilder,i=t.buildUrl(this.valuesUrl,e);return i},Filter.prototype._valuesToString=function(e){return JSON.stringify(e)};
var FilterValue=function(e,t){this.name=e,this.value=t};FilterValue.prototype.compare=function(e){return this.name==e.name&&this.value==e.value};
var URLBuilder=function(){};URLBuilder.prototype.buildUrl=function(e,n){var r="";r="&"==e.substring(e.length-1,e.length)?e:e+"?";for(var l=0;l<n.length;l++){var t=n[l];void 0!==t.value&&t.value.length>0&&(r=r+t.name+"="+t.value+"&")}return r.substring(0,r.length-1)};
!function(t){"use strict";var e=function(e,s){this.$element=t(e),this.options=t.extend({},t.fn.typeahead.defaults,s),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.updater=this.options.updater||this.updater,this.source=this.options.source,this.$menu=t(this.options.menu),this.shown=!1,this.listen()};e.prototype={constructor:e,select:function(){var t=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(t)).change(),this.hide()},updater:function(t){return t},show:function(){var e=t.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:e.top+e.height,left:e.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(){var e;return this.query=this.$element.val(),this.query.length<this.options.minLength?this.shown?this.hide():this:(e=t.isFunction(this.source)?this.source(this.query,t.proxy(this.process,this)):this.source,e?this.process(e):this)},process:function(e){var s=this;return e=t.grep(e,function(t){return s.matcher(t)}),e=this.sorter(e),e.length?this.render(e.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(t){return~t.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(t){for(var e,s=[],i=[],n=[];e=t.shift();)e.toLowerCase().indexOf(this.query.toLowerCase())?~e.indexOf(this.query)?i.push(e):n.push(e):s.push(e);return s.concat(i,n)},highlighter:function(t){var e=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return t.replace(new RegExp("("+e+")","ig"),function(t,e){return"<strong>"+e+"</strong>"})},render:function(e){var s=this;return e=t(e).map(function(e,i){return e=t(s.options.item).attr("data-value",i),e.find("a").html(s.highlighter(i)),e[0]}),e.first().addClass("active"),this.$menu.html(e),this},next:function(){var e=this.$menu.find(".active").removeClass("active"),s=e.next();s.length||(s=t(this.$menu.find("li")[0])),s.addClass("active")},prev:function(){var t=this.$menu.find(".active").removeClass("active"),e=t.prev();e.length||(e=this.$menu.find("li").last()),e.addClass("active")},listen:function(){this.$element.on("focus",t.proxy(this.focus,this)).on("blur",t.proxy(this.blur,this)).on("keypress",t.proxy(this.keypress,this)).on("keyup",t.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",t.proxy(this.keydown,this)),this.$menu.on("click",t.proxy(this.click,this)).on("mouseenter","li",t.proxy(this.mouseenter,this)).on("mouseleave","li",t.proxy(this.mouseleave,this))},eventSupported:function(t){var e=t in this.$element;return e||(this.$element.setAttribute(t,"return;"),e="function"==typeof this.$element[t]),e},move:function(t){if(this.shown){switch(t.keyCode){case 9:case 13:case 27:t.preventDefault();break;case 38:t.preventDefault(),this.prev();break;case 40:t.preventDefault(),this.next()}t.stopPropagation()}},keydown:function(e){this.suppressKeyPressRepeat=~t.inArray(e.keyCode,[40,38,9,13,27]),this.move(e)},keypress:function(t){this.suppressKeyPressRepeat||this.move(t)},keyup:function(t){switch(t.keyCode){case 40:case 38:case 16:case 17:case 18:case 9:break;case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}t.stopPropagation(),t.preventDefault()},focus:function(){0==this.$element.val()&&(this.focused=!0,this.lookup())},blur:function(){!this.mousedover&&this.shown&&this.hide()},click:function(t){t.stopPropagation(),t.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(e){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),t(e.currentTarget).addClass("active")},mouseleave:function(){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var s=t.fn.typeahead;t.fn.typeahead=function(s){return this.each(function(){var i=t(this),n=i.data("typeahead"),h="object"==typeof s&&s;n||i.data("typeahead",n=new e(this,h)),"string"==typeof s&&n[s]()})},t.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',minLength:0},t.fn.typeahead.Constructor=e,t.fn.typeahead.noConflict=function(){return t.fn.typeahead=s,this},t(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(){var e=t(this);e.data("typeahead")||e.typeahead(e.data())})}(window.jQuery);
var m=function e(t,n){function r(e){k=e.document,A=e.location,R=e.cancelAnimationFrame||e.clearTimeout,S=e.requestAnimationFrame||e.setTimeout}function o(){var e,t=[].slice.call(arguments),n=!(null==t[1]||I.call(t[1])!==M||"tag"in t[1]||"subtree"in t[1]),r=n?t[1]:{},o="class"in r?"class":"className",a={tag:"div",attrs:{}},i=[];if(I.call(t[0])!=L)throw new Error("selector in m(selector, attrs, children) should be a string");for(;e=q.exec(t[0]);)if(""===e[1]&&e[2])a.tag=e[2];else if("#"===e[1])a.attrs.id=e[2];else if("."===e[1])i.push(e[2]);else if("["===e[3][0]){var l=U.exec(e[3]);a.attrs[l[1]]=l[3]||(l[2]?"":!0)}i.length>0&&(a.attrs[o]=i.join(" "));var s=n?t[2]:t[1];a.children=I.call(s)===B?s:t.slice(n?2:1);for(var u in r)u===o?""!==r[u]&&(a.attrs[u]=(a.attrs[u]||"")+" "+r[u]):a.attrs[u]=r[u];return a}function a(e,t,r,o,u,d,f,h,m,p,g){if((null==u||null==u.toString())&&(u=""),"retain"===u.subtree)return d;var v=I.call(d),y=I.call(u);if(null==d||v!==y){if(null!=d)if(r&&r.nodes){var w=h-o,x=w+(y===B?u:d.nodes).length;s(r.nodes.slice(w,x),r.slice(w,x))}else d.nodes&&s(d.nodes,d);d=new u.constructor,d.tag&&(d={}),d.nodes=[]}if(y===B){for(var N=0,b=u.length;b>N;N++)I.call(u[N])===B&&(u=u.concat.apply([],u),N--);for(var C=[],E=d.length===u.length,T=0,O=1,j=2,A=3,S={},R=[],q=!1,N=0;N<d.length;N++)d[N]&&d[N].attrs&&null!=d[N].attrs.key&&(q=!0,S[d[N].attrs.key]={action:O,index:N});if(q){u.indexOf(null)>-1&&(u=u.filter(function(e){return null!=e}));var U=!1;if(u.length!=d.length)U=!0;else for(var H,J,N=0;H=d[N],J=u[N];N++)if(H.attrs&&J.attrs&&H.attrs.key!=J.attrs.key){U=!0;break}if(U){for(var N=0,b=u.length;b>N;N++)if(u[N]&&u[N].attrs)if(null!=u[N].attrs.key){var K=u[N].attrs.key;S[K]=S[K]?{action:A,index:N,from:S[K].index,element:d.nodes[S[K].index]||k.createElement("div")}:{action:j,index:N}}else R.push({index:N,element:e.childNodes[N]||k.createElement("div")});var $=[];for(var F in S)$.push(S[F]);for(var G,P=$.sort(i),V=new Array(d.length),N=0;G=P[N];N++){if(G.action===O&&(s(d[G.index].nodes,d[G.index]),V.splice(G.index,1)),G.action===j){var _=k.createElement("div");_.key=u[G.index].attrs.key,e.insertBefore(_,e.childNodes[G.index]||null),V.splice(G.index,0,{attrs:{key:u[G.index].attrs.key},nodes:[_]})}G.action===A&&(e.childNodes[G.index]!==G.element&&null!==G.element&&e.insertBefore(G.element,e.childNodes[G.index]||null),V[G.index]=d[G.from])}for(var N=0,b=R.length;b>N;N++){var G=R[N];e.insertBefore(G.element,e.childNodes[G.index]||null),V[G.index]=d[G.index]}d=V,d.nodes=new Array(e.childNodes.length);for(var Y,N=0;Y=e.childNodes[N];N++)d.nodes[N]=Y}}for(var N=0,W=0,b=u.length;b>N;N++){var X=a(e,t,d,h,u[N],d[W],f,h+T||T,m,p,g);X!==n&&(X.nodes.intact||(E=!1),T+=X.$trusted?(X.match(/<[^\/]|\>\s*[^<]/g)||[]).length:I.call(X)===B?X.length:1,d[W++]=X)}if(!E){for(var N=0,b=u.length;b>N;N++)null!=d[N]&&C.push.apply(C,d[N].nodes);for(var Q,N=0;Q=d.nodes[N];N++)null!=Q.parentNode&&C.indexOf(Q)<0&&s([Q],[d[N]]);u.length<d.length&&(d.length=u.length),d.nodes=C}}else if(null!=u&&y===M){u.attrs||(u.attrs={}),d.attrs||(d.attrs={});var Z=Object.keys(u.attrs),ee=Z.length>("key"in u.attrs?1:0);if((u.tag!=d.tag||Z.join()!=Object.keys(d.attrs).join()||u.attrs.id!=d.attrs.id)&&(d.nodes.length&&s(d.nodes),d.configContext&&typeof d.configContext.onunload===D&&d.configContext.onunload()),I.call(u.tag)!=L)return;var Q,te=0===d.nodes.length;if(u.attrs.xmlns?p=u.attrs.xmlns:"svg"===u.tag?p="http://www.w3.org/2000/svg":"math"===u.tag&&(p="http://www.w3.org/1998/Math/MathML"),te?(Q=u.attrs.is?p===n?k.createElement(u.tag,u.attrs.is):k.createElementNS(p,u.tag,u.attrs.is):p===n?k.createElement(u.tag):k.createElementNS(p,u.tag),d={tag:u.tag,attrs:ee?l(Q,u.tag,u.attrs,{},p):u.attrs,children:null!=u.children&&u.children.length>0?a(Q,u.tag,n,n,u.children,d.children,!0,0,u.attrs.contenteditable?Q:m,p,g):u.children,nodes:[Q]},d.children&&!d.children.nodes&&(d.children.nodes=[]),"select"===u.tag&&u.attrs.value&&l(Q,u.tag,{value:u.attrs.value},{},p),e.insertBefore(Q,e.childNodes[h]||null)):(Q=d.nodes[0],ee&&l(Q,u.tag,u.attrs,d.attrs,p),d.children=a(Q,u.tag,n,n,u.children,d.children,!1,0,u.attrs.contenteditable?Q:m,p,g),d.nodes.intact=!0,f===!0&&null!=Q&&e.insertBefore(Q,e.childNodes[h]||null)),typeof u.attrs.config===D){var ne=d.configContext=d.configContext||{},re=function(e,t){return function(){return e.attrs.config.apply(e,t)}};g.push(re(u,[Q,!te,ne,d]))}}else if(typeof y!=D){var C;0===d.nodes.length?(u.$trusted?C=c(e,h,u):(C=[k.createTextNode(u)],e.nodeName.match(z)||e.insertBefore(C[0],e.childNodes[h]||null)),d="string number boolean".indexOf(typeof u)>-1?new u.constructor(u):u,d.nodes=C):d.valueOf()!==u.valueOf()||f===!0?(C=d.nodes,m&&m===k.activeElement||(u.$trusted?(s(C,d),C=c(e,h,u)):"textarea"===t?e.value=u:m?m.innerHTML=u:((1===C[0].nodeType||C.length>1)&&(s(d.nodes,d),C=[k.createTextNode(u)]),e.insertBefore(C[0],e.childNodes[h]||null),C[0].nodeValue=u)),d=new u.constructor(u),d.nodes=C):d.nodes.intact=!0}return d}function i(e,t){return e.action-t.action||e.index-t.index}function l(e,t,n,r,o){for(var a in n){var i=n[a],l=r[a];if(a in r&&l===i)"value"===a&&"input"===t&&e.value!=i&&(e.value=i);else{r[a]=i;try{if("config"===a||"key"==a)continue;if(typeof i===D&&0===a.indexOf("on"))e[a]=d(i,e);else if("style"===a&&null!=i&&I.call(i)===M){for(var s in i)(null==l||l[s]!==i[s])&&(e.style[s]=i[s]);for(var s in l)s in i||(e.style[s]="")}else null!=o?"href"===a?e.setAttributeNS("http://www.w3.org/1999/xlink","href",i):"className"===a?e.setAttribute("class",i):e.setAttribute(a,i):a in e&&"list"!==a&&"style"!==a&&"form"!==a&&"type"!==a?("input"!==t||e[a]!==i)&&(e[a]=i):e.setAttribute(a,i)}catch(u){if(u.message.indexOf("Invalid argument")<0)throw u}}}return r}function s(e,t){for(var n=e.length-1;n>-1;n--)if(e[n]&&e[n].parentNode){try{e[n].parentNode.removeChild(e[n])}catch(r){}t=[].concat(t),t[n]&&u(t[n])}0!=e.length&&(e.length=0)}function u(e){if(e.configContext&&typeof e.configContext.onunload===D&&e.configContext.onunload(),e.children)if(I.call(e.children)===B)for(var t,n=0;t=e.children[n];n++)u(t);else e.children.tag&&u(e.children)}function c(e,t,n){var r=e.childNodes[t];if(r){var o=1!=r.nodeType,a=k.createElement("span");o?(e.insertBefore(a,r||null),a.insertAdjacentHTML("beforebegin",n),e.removeChild(a)):r.insertAdjacentHTML("beforebegin",n)}else e.insertAdjacentHTML("beforeend",n);for(var i=[];e.childNodes[t]!==r;)i.push(e.childNodes[t]),t++;return i}function d(e,t){return function(n){n=n||event,o.redraw.strategy("diff"),o.startComputation();try{return e.call(t,n)}finally{ee()}}}function f(e){var t=K.indexOf(e);return 0>t?K.push(e)-1:t}function h(e){var t=function(){return arguments.length&&(e=arguments[0]),e};return t.toJSON=function(){return e},t}function m(){for(var e,t="all"===o.redraw.strategy(),n=0;e=G[n];n++)V[n]&&o.render(e,P[n].view?P[n].view(V[n]):Q(),t);W&&(W(),W=null),_=null,Y=new Date,o.redraw.strategy("diff")}function p(e){return e.slice(re[o.route.mode].length)}function g(e,t,n){te={};var r=n.indexOf("?");-1!==r&&(te=x(n.substr(r+1,n.length)),n=n.substr(0,r));for(var a in t){if(a===n)return o.module(e,t[a]),!0;var i=new RegExp("^"+a.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(i.test(n))return n.replace(i,function(){for(var n=a.match(/:[^\/]+/g)||[],r=[].slice.call(arguments,1,-2),i=0,l=n.length;l>i;i++)te[n[i].replace(/:|\./g,"")]=decodeURIComponent(r[i]);o.module(e,t[a])}),!0}}function v(e){if(e=e||event,!e.ctrlKey&&!e.metaKey&&2!==e.which){e.preventDefault?e.preventDefault():e.returnValue=!1;var t=e.currentTarget||this,n="pathname"===o.route.mode&&t.search?x(t.search.slice(1)):{};o.route(t[o.route.mode].slice(re[o.route.mode].length),n)}}function y(){"hash"!=o.route.mode&&A.hash?A.hash=A.hash:t.scrollTo(0,0)}function w(e,t){var n=[];for(var r in e){var o=t?t+"["+r+"]":r,a=e[r],i=I.call(a),l=null!=a&&i===M?w(a,o):i===B?a.map(function(e){return encodeURIComponent(o+"[]")+"="+encodeURIComponent(e)}).join("&"):encodeURIComponent(o)+"="+encodeURIComponent(a);n.push(l)}return n.join("&")}function x(e){for(var t=e.split("&"),n={},r=0,o=t.length;o>r;r++){var a=t[r].split("=");n[decodeURIComponent(a[0])]=a[1]?decodeURIComponent(a[1]):""}return n}function N(e){var t=f(e);s(e.childNodes,$[t]),$[t]=n}function b(e){var t=o.prop();return e.then(t),t.then=function(t,n){return b(e.then(t,n))},t}function C(e,t){function n(e){d=e||u,h.map(function(e){d===s&&e.resolve(f)||e.reject(f)})}function r(e,t,n,r){if((null!=f&&I.call(f)===M||typeof f===D)&&typeof e===D)try{var a=0;e.call(f,function(e){a++||(f=e,t())},function(e){a++||(f=e,n())})}catch(i){o.deferred.onerror(i),f=i,n()}else r()}function a(){var u;try{u=f&&f.then}catch(h){return o.deferred.onerror(h),f=h,d=l,a()}r(u,function(){d=i,a()},function(){d=l,a()},function(){try{d===i&&typeof e===D?f=e(f):d===l&&"function"==typeof t&&(f=t(f),d=i)}catch(a){return o.deferred.onerror(a),f=a,n()}f===c?(f=TypeError(),n()):r(u,function(){n(s)},n,function(){n(d===i&&s)})})}var i=1,l=2,s=3,u=4,c=this,d=0,f=0,h=[];c.promise={},c.resolve=function(e){return d||(f=e,d=i,a()),this},c.reject=function(e){return d||(f=e,d=l,a()),this},c.promise.then=function(e,t){var n=new C(e,t);return d===s?n.resolve(f):d===u?n.reject(f):h.push(n),n.promise}}function E(e){return e}function T(e){if(!e.dataType||"jsonp"!==e.dataType.toLowerCase()){var r=new t.XMLHttpRequest;if(r.open(e.method,e.url,!0,e.user,e.password),r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<300?e.onload({type:"load",target:r}):e.onerror({type:"error",target:r}))},e.serialize===JSON.stringify&&e.data&&"GET"!==e.method&&r.setRequestHeader("Content-Type","application/json; charset=utf-8"),e.deserialize===JSON.parse&&r.setRequestHeader("Accept","application/json, text/*"),typeof e.config===D){var o=e.config(r,e);null!=o&&(r=o)}var a="GET"!==e.method&&e.data?e.data:"";if(a&&I.call(a)!=L&&a.constructor!=t.FormData)throw"Request data should be either be a string or FormData. Check the `serialize` option in `m.request`";return r.send(a),r}var i="mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),l=k.createElement("script");t[i]=function(r){l.parentNode.removeChild(l),e.onload({type:"load",target:{responseText:r}}),t[i]=n},l.onerror=function(){return l.parentNode.removeChild(l),e.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),t[i]=n,!1},l.onload=function(){return!1},l.src=e.url+(e.url.indexOf("?")>0?"&":"?")+(e.callbackKey?e.callbackKey:"callback")+"="+i+"&"+w(e.data||{}),k.body.appendChild(l)}function O(e,t,n){if("GET"===e.method&&"jsonp"!=e.dataType){var r=e.url.indexOf("?")<0?"?":"&",o=w(t);e.url=e.url+(o?r+o:"")}else e.data=n(t);return e}function j(e,t){var n=e.match(/:[a-z]\w+/gi);if(n&&t)for(var r=0;r<n.length;r++){var o=n[r].slice(1);e=e.replace(n[r],t[o]),delete t[o]}return e}var k,A,S,R,M="[object Object]",B="[object Array]",L="[object String]",D="function",I={}.toString,q=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,U=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/,z=/^(AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TRACK|WBR)$/;r(t);var H,J={appendChild:function(e){H===n&&(H=k.createElement("html")),k.documentElement&&k.documentElement!==e?k.replaceChild(e,k.documentElement):k.appendChild(e),this.childNodes=k.childNodes},insertBefore:function(e){this.appendChild(e)},childNodes:[]},K=[],$={};o.render=function(e,t,r){var o=[];if(!e)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var i=f(e),l=e===k,u=l||e===k.documentElement?J:e;l&&"html"!=t.tag&&(t={tag:"html",attrs:{},children:t}),$[i]===n&&s(u.childNodes),r===!0&&N(e),$[i]=a(u,null,n,n,t,$[i],!1,0,null,n,o);for(var c=0,d=o.length;d>c;c++)o[c]()},o.trust=function(e){return e=new String(e),e.$trusted=!0,e},o.prop=function(e){return(null!=e&&I.call(e)===M||typeof e===D)&&typeof e.then===D?b(e):h(e)};var F,G=[],P=[],V=[],_=null,Y=0,W=null,X=16;o.module=function(e,t){if(!e)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var n=G.indexOf(e);0>n&&(n=G.length);var r=!1;if(V[n]&&typeof V[n].onunload===D){var a={preventDefault:function(){r=!0}};V[n].onunload(a)}if(!r){o.redraw.strategy("all"),o.startComputation(),G[n]=e;var i=F=t=t||{},l=new(t.controller||function(){});return i===F&&(V[n]=l,P[n]=t),ee(),V[n]}},o.redraw=function(e){_&&e!==!0?(new Date-Y>X||S===t.requestAnimationFrame)&&(_>0&&R(_),_=S(m,X)):(m(),_=S(function(){_=null},X))},o.redraw.strategy=o.prop();var Q=function(){return""},Z=0;o.startComputation=function(){Z++},o.endComputation=function(){Z=Math.max(Z-1,0),0===Z&&o.redraw()};var ee=function(){"none"==o.redraw.strategy()?(Z--,o.redraw.strategy("diff")):o.endComputation()};o.withAttr=function(e,t){return function(n){n=n||event;var r=n.currentTarget||this;t(e in r?r[e]:r.getAttribute(e))}};var te,ne,re={pathname:"",hash:"#",search:"?"},oe=function(){};return o.route=function(){if(0===arguments.length)return ne;if(3===arguments.length&&I.call(arguments[1])===L){var e=arguments[0],n=arguments[1],r=arguments[2];oe=function(t){var a=ne=p(t);g(e,r,a)||o.route(n,!0)};var a="hash"===o.route.mode?"onhashchange":"onpopstate";t[a]=function(){var e=A[o.route.mode];"pathname"===o.route.mode&&(e+=A.search),ne!=p(e)&&oe(e)},W=y,t[a]()}else if(arguments[0].addEventListener){var i=arguments[0];arguments[1],arguments[2],i.href=("pathname"!==o.route.mode?A.pathname:"")+re[o.route.mode]+this.attrs.href,i.removeEventListener("click",v),i.addEventListener("click",v)}else if(I.call(arguments[0])===L){var l=ne;ne=arguments[0];var s=arguments[1]||{},u=ne.indexOf("?"),c=u>-1?x(ne.slice(u+1)):{};for(var d in s)c[d]=s[d];var f=w(c),h=u>-1?ne.slice(0,u):ne;f&&(ne=h+(-1===h.indexOf("?")?"?":"&")+f);var m=(3===arguments.length?arguments[2]:arguments[1])===!0||l===arguments[0];t.history.pushState?(W=function(){t.history[m?"replaceState":"pushState"](null,k.title,re[o.route.mode]+ne),y()},oe(re[o.route.mode]+ne)):A[o.route.mode]=ne}},o.route.param=function(e){if(!te)throw new Error("You must call m.route(element, defaultRoute, routes) before calling m.route.param()");return te[e]},o.route.mode="search",o.deferred=function(){var e=new C;return e.promise=b(e.promise),e},o.deferred.onerror=function(e){if("[object Error]"===I.call(e)&&!e.constructor.toString().match(/ Error/))throw e},o.sync=function(e){function t(e,t){return function(o){return i[e]=o,t||(n="reject"),0===--a&&(r.promise(i),r[n](i)),o}}var n="resolve",r=o.deferred(),a=e.length,i=new Array(a);if(e.length>0)for(var l=0;l<e.length;l++)e[l].then(t(l,!0),t(l,!1));else r.resolve([]);return r.promise},o.request=function(e){e.background!==!0&&o.startComputation();var t=o.deferred(),n=e.dataType&&"jsonp"===e.dataType.toLowerCase(),r=e.serialize=n?E:e.serialize||JSON.stringify,a=e.deserialize=n?E:e.deserialize||JSON.parse,i=e.extract||function(e){return 0===e.responseText.length&&a===JSON.parse?null:e.responseText};return e.url=j(e.url,e.data),e=O(e,e.data,r),e.onload=e.onerror=function(n){try{n=n||event;var r=("load"===n.type?e.unwrapSuccess:e.unwrapError)||E,l=r(a(i(n.target,e)));if("load"===n.type)if(I.call(l)===B&&e.type)for(var s=0;s<l.length;s++)l[s]=new e.type(l[s]);else e.type&&(l=new e.type(l));t["load"===n.type?"resolve":"reject"](l)}catch(n){o.deferred.onerror(n),t.reject(n)}e.background!==!0&&o.endComputation()},T(e),t.promise(e.initialValue),t.promise},o.deps=function(e){return r(t=e||t),t},o.deps.factory=e,o}("undefined"!=typeof window?window:{});"undefined"!=typeof module&&null!==module&&module.exports?module.exports=m:"function"==typeof define&&define.amd&&define(function(){return m});
var KildeViserSearchSDK=function(){var e=function(e){var t={};return t.collectionId=e,t.controller=function(){t.vm.init(t.collectionId)},t.view=function(){return m("div",{"class":"kildeviser"},[t.ViewFilter(),m("button",{"class":"regularsubmit",onclick:function(){t.vm.search()}},"Find"),m("p",t.vm.status())])},t.vm=function(){var e={};return e.status=m.prop(""),e.init=function(t){this.collection=new Collection(t),e.collection=this.collection,this.collection.get()},e.search=function(){e.status(""),this.collection.search().then(function(t){if(t.length>0){{new URLBuilder}-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")&&window.location.assign("http://www.kbharkiv.dk/kildeviser/#?collection="+this.collection.id()+"&item="+t[0].id);{var i="http://www.kbharkiv.dk/kildeviser/#?collection="+this.collection.id()+"&item="+t[0].id;window.open(i)}}else e.status("Ingen resultater fundet")}.bind(this))},e.focus=m.prop(void 0),e}(),t.ViewFilter=function(){return t.vm.collection.filters.map(function(e){return[m("div",{"class":"span12"},[m("input",{type:"text",id:"filter-"+e.name(),"class":"span12 typeahead","data-provide":"typeahead",autocomplete:"off","data-items":"6","data-minLength":"0",curFilter:e.name(),value:e.selectedValue(),placeholder:e.placeHolder(),helpText:e.helpText(),disabled:0===e.values.length?!0:!1,onchange:function(i){e.selectedValue(i.target.value),t.vm.collection.updateFilters(e.name(),e.selectedValue())},config:function(t){var i=jQuery(t).typeahead();i.data("typeahead").source=e.values,$(t).on("keydown",function(e){(40==e.keyCode||38==e.keyCode)&&($parentDiv=$(t),$innerListItem=$(t).parent().find("li.active").first(),$(".typeahead.dropdown-menu").scrollTop($innerListItem.prevAll().length*$innerListItem.height()))})}}),m("div",{"class":"clearfield",onclick:function(){t.vm.collection.updateFilters(e.name(),"")}},"X"),m("p",[m("i",e.helpText())])]),m(".clearfix")]})},t},t={};return t.init=function(t,i){var n=new e(t);m.module(document.getElementById(i),{controller:n.controller,view:n.view})},t}();